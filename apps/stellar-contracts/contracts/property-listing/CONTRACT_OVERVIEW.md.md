# PropertyListing Smart Contract Documentation

## Overview

**StellarRent** is a decentralized, peer-to-peer rental platform built on the Stellar blockchain. It aims to provide secure, transparent, and cost-efficient rentals for everyone, eliminating high fees, slow payments, and lack of transparency found in traditional rental platforms.

The core of StellarRent's on-chain logic is the `property-listing` smart contract, which acts as a tamper-proof registry for property listings. This contract is written in Rust using Soroban and is deployed on the Stellar network.

---

## What Does the PropertyListing Contract Do?

- **Creates property listings**: Allows hosts to register new properties on-chain.
- **Updates listings**: Only the property owner can update their listing's essential data.
- **Verifies listing integrity**: Anyone can query a listing's essential data (ID, hash, owner, status) to verify its integrity.
- **Keeps the blockchain lean**: Only essential data is stored on-chain; full property details (description, images, etc.) are stored off-chain (e.g., in Supabase).

---

## Why "property-listing"?

The contract is named `property-listing` because its main purpose is to manage (create, update, query) property listings for StellarRent. It is the single source of truth for which properties exist, who owns them, and their current status, while all heavy or mutable data lives off-chain.

---

## How Does It Work?

### Data Model (On-Chain)

Each property listing on-chain stores:
- **ID**: Unique identifier (e.g., a UUID generated by Supabase).
- **Data Hash**: A hash (e.g., SHA-256) of the key property data (title, price, location, amenities, image URLs, etc.) to verify off-chain data integrity.
- **Owner**: The Stellar address of the host who created the listing.
- **Status**: The current state of the property (e.g., `Available`, `Booked`, `Maintenance`).

### Data Model (Off-Chain)

- **Full property details** (title, description, images, etc.) are stored in Supabase or another backend.
- The hash of these details is stored on-chain for integrity verification.

---

## Core Functions

### 1. Create Listing

**Purpose:** Register a new property listing.

**CLI Example:**
```bash
stellar contract invoke \
  --id <CONTRACT_ID> \
  --network testnet \
  --source-account alice \
  -- create_listing \
  --id PROP1 \
  --data_hash HASH1 \
  --owner <OWNER_ADDRESS>
```
- `PROP1`: Unique property ID.
- `HASH1`: Hash of the property's key data.
- `<OWNER_ADDRESS>`: Stellar address of the host (e.g., alice's public key).

**Result:**  
Returns the created listing. Fails if the ID already exists.

---

### 2. Update Listing

**Purpose:** Update the hash of an existing property listing. Only the owner can do this.

**CLI Example:**
```bash
stellar contract invoke \
  --id <CONTRACT_ID> \
  --network testnet \
  --source-account alice \
  -- update_listing \
  --id PROP1 \
  --data_hash HASH2 \
  --owner <OWNER_ADDRESS>
```
- `HASH2`: New hash after updating off-chain data.

**Result:**  
Returns the updated listing. Fails if the owner does not match.

---

### 3. Update Status

**Purpose:** Change the status of a property (e.g., from `Available` to `Booked`).

**CLI Example:**
```bash
stellar contract invoke \
  --id <CONTRACT_ID> \
  --network testnet \
  --source-account alice \
  -- update_status \
  --id PROP1 \
  --owner <OWNER_ADDRESS> \
  --status Booked
```
- `--status` can be `Available`, `Booked`, or `Maintenance`.

**Result:**  
Returns the updated listing with the new status.

---

### 4. Get Listing

**Purpose:** Query the essential data of a property listing.

**CLI Example:**
```bash
stellar contract invoke \
  --id <CONTRACT_ID> \
  --network testnet \
  --source-account alice \
  -- get_listing \
  --id PROP1
```

**Result:**  
Returns the listing's data (ID, hash, owner, status).

---

### 5. Get All Listings

**Purpose:** (If implemented) Returns all property listings.

**CLI Example:**
```bash
stellar contract invoke \
  --id <CONTRACT_ID> \
  --network testnet \
  --source-account alice \
  -- get_all_listings
```

**Result:**  
Returns an array of all listings.  
_Note: In the current contract, this is a stub and returns an empty array. You can extend the contract to support this._

---

## How Does It Integrate with the Backend/Frontend?

### Backend (Node.js/Express + Supabase)

- **Create Listing:**
  1. User submits property details via frontend.
  2. Backend saves full details in Supabase, generates a unique ID.
  3. Backend computes a hash of the key data.
  4. Backend invokes `create_listing` on the contract with the ID, hash, and owner address.

- **Update Listing:**
  1. User updates property details via frontend.
  2. Backend updates Supabase, recalculates the hash.
  3. Backend invokes `update_listing` on the contract.

- **Query Listing:**
  1. Frontend fetches full details from Supabase.
  2. Frontend or backend fetches the hash from the contract and verifies it matches the hash of the off-chain data.

### Frontend (Next.js)

- Interacts with the backend for all property data.
- Can optionally verify on-chain hash for data integrity.
- Can display on-chain status and owner for transparency.

---

## Security & Trust

- **Owner-only updates:** Only the address that created a listing can update it.
- **Data integrity:** The hash ensures that off-chain data hasn't been tampered with.
- **Status tracking:** The on-chain status can be used for booking logic, availability, etc.

---

## Example Workflow

1. **Host creates a property:**  
   - Data saved in Supabase.
   - Hash and ID registered on-chain.

2. **Host updates property:**  
   - Data updated in Supabase.
   - New hash registered on-chain.

3. **Tenant queries property:**  
   - Data fetched from Supabase.
   - Hash checked against on-chain value for integrity.

---

## Resources

- [Stellar CLI Docs](https://developers.stellar.org/docs/tools/cli/stellar-cli)
- [Soroban Smart Contracts](https://developers.stellar.org/docs/build/smart-contracts)
- [StellarRent GitBook](https://stellar-rent.gitbook.io/stellar-rent)

---

## TL;DR

- The `property-listing` contract is the on-chain registry for all property listings in StellarRent.
- Only essential data (ID, hash, owner, status) is stored on-chain; everything else is off-chain.
- All contract functions can be tested and used via the Stellar CLI.
- The backend coordinates off-chain storage and on-chain registration.
- The contract is secure, owner-restricted, and designed for easy integration with any backend/frontend.

---

**Let's build a fairer, more efficient rental ecosystem together! ðŸŒŸ**
